---
title: "Chapter 5"
output:
  pdf_document: default
  html_document: default
date: "2024-06-20"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## A Second-Order (Quadratic) Model with One Independent Variable



```{r}
#beta1
par(mfrow=c(3,2))
eq=function(x){1-5*x+x^2}
curve(eq,from=-20, to=20, xlab="x", ylab="y", 
      ylim=c(-5,100), xlim = c(-20,10))
title(main="1-5*x+x^2")
eq=function(x){1+5*x+x^2}
curve(eq,from=-20, to=10, xlab="x", 
      ylab="y", ylim=c(-5,100), xlim = c(-20,10))
title(main="1+5*x+x^2")
#beta2
eq=function(x){x+10*x^2}
curve(eq,from=-10, to=10, xlab="x", 
      ylab="y", ylim=c(0,100), xlim = c(-10,10))
title(main="x+10*x^2")
eq=function(x){x+x^2}
curve(eq,from=-10, to=10, xlab="x", 
      ylab="y", ylim=c(0,100), xlim = c(-10,10))
title(main="x+x^2")
#-Beta2
eq=function(x){x+10*x^2}
curve(eq,from=-10, to=10, xlab="x", 
      ylab="y", ylim=c(0,100), xlim = c(-10,10))
title(main="x+10*x^2")
eq=function(x){x-10*x^2}
curve(eq,from=-10, to=10, xlab="x", ylab="y", 
      ylim=c(-100,10), xlim = c(-10,10))
title(main="x-10*x^2")

```
##No $\beta_0$

```{r}
par(mfrow=c(1,2))
eq=function(x){10-5*x+x^2}
curve(eq,from=-20, to=20, xlab="x", ylab="y", 
      ylim=c(-5,100), xlim = c(-20,10))
title(main="10-5*x+x^2")
eq=function(x){-5*x+x^2}
curve(eq,from=-20, to=20, xlab="x", ylab="y", 
      ylim=c(-5,100), xlim = c(-20,10))
title(main="-5*x+x^2")
```

##Third-Order Model with One Independent Variable


```{r}

#beta3

par(mfrow=c(1,2))
eq=function(x){1+x+x^2+x^3}
curve(eq, xlab="x", ylab="y", ylim=c(-5,5), xlim = c(-5,5))
title(main="1+x+x^2+x^3")
eq=function(x){1+x+x^2-x^3}
curve(eq, xlab="x", ylab="y", ylim=c(-5,5), xlim = c(-5,5))
title(main="1+x+x^2-x^3")

```

```{r}

#Comparing bata 1

par(mfrow=c(1,2))
eq=function(x){1+x+x^2+x^3}
curve(eq, xlab="x", ylab="y", ylim=c(-5,5), xlim = c(-5,5))
title(main="1+x+x^2+x^3")
eq=function(x){1+2*x+x^2+x^3}
curve(eq, xlab="x", ylab="y", ylim=c(-5,5), xlim = c(-5,5))
title(main="1+2x+x^2+x^3")

```

```{r}

#Comparing bata 2

par(mfrow=c(1,2))
eq=function(x){1+x+x^2+x^3}
curve(eq, xlab="x", ylab="y", ylim=c(-5,5), xlim = c(-5,5))
title(main="1+x+x^2+x^3")
eq=function(x){1+x+3*x^2+x^3}
curve(eq, xlab="x", ylab="y", ylim=c(-5,5), xlim = c(-5,5))
title(main="1+x+3x^2+x^3")

```

```{r}

#Comparing bata 3

par(mfrow=c(1,2))
eq=function(x){1+x+x^2+x^3}
curve(eq, xlab="x", ylab="y", ylim=c(-5,5), xlim = c(-5,5))
title(main="1+x+x^2+x^3")
eq=function(x){1+x+x^2+3*x^3}
curve(eq, xlab="x", ylab="y", ylim=c(-5,5), xlim = c(-5,5))
title(main="1+x+3x^2+3x^3")

```


##Example 5.2.1 

Refer to the Cooling method for gas turbines data set.

a) Construct a scatterplot relating heat rate to airflow. What type of model is suggested by the plot?

```{r}
#sientific is off
#options(scipen = 999)
#or format(model$coefficients[1], sientific=FALSE)

GASTURBINE=read.table("GASTURBINE.txt",header = TRUE)
head(GASTURBINE)
attach(GASTURBINE)

plot( x= AIRFLOW,y= HEATRATE, main="HEAT RATE vs. AIR FLOW", pch=19, col="blue",
      ylim = c(8000, 20000), xlim =c(0, 800), xlab = "Air flow (kilograms per second)", 
      ylab = " Heat rate (kilojoules per kilowatt per hour)" )

```



b) Fit the third-order model to the data for the heat rate $(y)$ using AIRFLOW.

```{r}
modelPly3=lm(HEATRATE~AIRFLOW+I(AIRFLOW^2)+I(AIRFLOW^3),data = GASTURBINE)
summary(modelPly3)
```

Fit the scond-order model to the data for the heat rate $(y)$ using AIRFLOW.

```{r}
modelQuad=lm(HEATRATE~AIRFLOW+I(AIRFLOW^2),data = GASTURBINE)
summary(modelQuad)

```

Compare the two models by using the scatterplot:

```{r}

plot( x= AIRFLOW,y= HEATRATE, main="HEAT RATE vs. AIR FLOW", pch=19, col="blue",
      ylim = c(8000, 20000), xlim =c(0, 800), xlab = "Air flow (kilograms per second)", 
      ylab = " Heat rate (kilojoules per kilowatt per hour)" )
range(AIRFLOW)
QUAD<- seq(3,737,0.1)

lines(QUAD,predict(modelPly3,newdata=data.frame(AIRFLOW=QUAD)),col="black")

lines(QUAD,predict(modelQuad,newdata=data.frame(AIRFLOW=QUAD)),col="red")

legend("topleft", legend = c("Third-Order Model","Quadratic Model" ),lty=1:1, col = c("Black", "Red"))
```

c) Fit a complete second-order model to the data for heat rate (kilojoules per kilowatt per hour) $(y)$ as a function of cycle speed (revolutions per minute) and cycle pressure ratio. Recall that the data are saved in the GASTURBINE file.

```{r}
modelCom2=lm(HEATRATE~RPM+CPRATIO+RPM*CPRATIO+I(RPM^2)+I(CPRATIO^2))
summary(modelCom2)

pairs(~HEATRATE+RPM+CPRATIO,data = GASTURBINE, 
      main="Scatterplot Matrix of Gas Turbines")
```

e)Graph the relationship between heat rate and cycle pressure ratio when cycle speed is held constant at $5,000$ rpm. Repeat part d when cycle speed is held constant at $15,000$ rpm. Compare the two graphs, parts d and e. What do you observe?

# RPM = 5000 rpm

```{r}

new1=data.frame(RPM=c(5000), CPRATIO=GASTURBINE$CPRATIO)
y=predict(modelCom2, newdata=new1)
plot(x=CPRATIO,y=y, main = "Scatterplot of predicted Heat Rate and CPRATIO, RPM=5000", 
     ylab = "Predicted Heat Rate", xlab ="CPRATIO", 
     ylim = c(8000, 15000), xlim=c(0,40),pch=19, col="blue")
```
# RPM = 15000 rpm

```{r}
new2=data.frame(RPM=c(15000), CPRATIO=GASTURBINE$CPRATIO)
y=predict(modelCom2, newdata=new2)
plot(x=CPRATIO,y=y, main = "Scatterplot of predicted Heat Rate and CPRATIO, RPM=15000", 
     ylab = "Predicted Heat Rate", xlab ="CPRATIO", 
     ylim = c(8000, 15000), xlim=c(0,40),pch=19, col="blue")

```
# Scatter plot with both fitted curves, $RPM =5000$ rpm and $RPM=15000$ rmp

```{r}
plot( x= CPRATIO,y= HEATRATE, main="HEAT RATE vs. CPRATIO", pch=19, col="blue",
      ylim = c(8000, 20000), , xlim =c(0, 50), xlab = "CPRATIO", 
      ylab = " Heat rate (kilojoules per kilowatt per hour)" )

range(CPRATIO)

CP<- seq(6.6,35,0.1)






#lines(CP,predict(modelCom2,data.frame(CPRATIO=CP, RPM=c(5000)),col="black"),lwd=2)


#lines(CP,predict(modelCom2,data.frame(CPRATIO=CP, RPM=c(15000))),col="red",lwd=2)

lines(CP,predict(modelCom2,data.frame(CPRATIO=CP, RPM=c(5000))), col="black",lwd=2)


lines(CP,predict(modelCom2,data.frame(CPRATIO=CP, RPM=c(15000))),col="red",lwd=2)

legend("topleft", legend = c("RPM=5000 rpm","RPM=15000 rpm" ),lty=1:1, col = c("Black","Red"))

```
Scatter plot with the predicted points, RPM =5000 rpm and RPM=15000 rmp

```{r}
new1=data.frame(RPM=c(5000), CPRATIO=GASTURBINE$CPRATIO)
y1=predict(modelCom2, newdata=new1)
new2=data.frame(RPM=c(15000), CPRATIO=GASTURBINE$CPRATIO)
y2=predict(modelCom2, newdata=new2)
plot(x=CPRATIO,y=y1, main = "Scatterplot of predicted Heat Rate and CPRATIO, RPM=5000 and 15000", 
     ylab = "Predicted Heat Rate", xlab ="CPRATIO", 
     ylim = c(8000, 15000), xlim=c(0,40),pch=19, col="blue")

#adding Predicted points for RPM = 15000
points(x=CPRATIO, y= y2, col="red",pch=19)
legend("topleft", c("RPM =5000","RPM=15000"), 
       cex = 0.7, fill = c("Blue","Red"))

#New Model

model3=lm(HEATRATE~RPM+CPRATIO+I(CPRATIO^2))
summary(model3)

detach(GASTURBINE)
```

#Example 5.3.1 

The performance, $y$ (measured as mass burning rate per degree of crank angle), for the six combinations of fuel type and engine brand is shown in Table 5.8. The number of test runs per combination varies from one for levels (F1, B2) to three for levels (F1, B1). Dtat set: DIESEL

```{r}
DIESEL=read.table("DIESEL.txt",header = TRUE)
head(DIESEL)
View(DIESEL)
attach(DIESEL)
```


(a) Assume the interaction between F and B is negligible. Fit the model for $E(y)$ with interaction terms omitted.

```{r}
table(FUEL)
table(BRAND)
x1=ifelse(FUEL=="F2", 1, 0)
x2=ifelse(FUEL=="F3", 1, 0)
x3=ifelse(BRAND=="B2", 1, 0)
##creating a data frame
DIESELDUMMY=data.frame(FUELBRAND,PERFORM=DIESEL$PERFORM, x1, x2,x3)
detach(DIESEL)
attach(DIESELDUMMY)
View(DIESELDUMMY)
head(DIESELDUMMY)
# Model with main effects
modelDUMMY1=lm(PERFORM~x1+x2+x3)
summary(modelDUMMY1)
predict(modelDUMMY1,DIESELDUMMY, interval="confidence",level=0.95)

predict(modelDUMMY1,DIESELDUMMY, interval="prediction",level=0.95)
#%95CI for F3 B2 for Main Model
New=data.frame(x1=c(0), x2=c(1), x3=c(1))
predict(modelDUMMY1,New, interval="confidence",level=0.95)
```

(b) Fit the complete model for $E(y)$ allowing for the fact that interactions might occur.

```{r}
######Interaction
modelDUMMY2=lm(PERFORM~x1+x2+x3+x1*x3+x2*x3)
summary(modelDUMMY2)

```

(c) Use the prediction equation for the model, part a to estimate the mean engine performance when fuel $F_3$ is used in brand $B_2$. 

```{r}
#%95CI for F3 B2 for Complete Model
New=data.frame(x1=c(0), x2=c(1), x3=c(1))
predict(modelDUMMY2,New, interval="confidence",level=0.95)


```


The following output shows the observations for combinations of fuel type of $F_3$ and diesel engine brand of $B_2$ and the sample mean for the corresponding cell $(F_3,B_2)$, $\bar{y}_{32}$.

```{r}
##Table for a subset of the data set
Table_F3_B2=subset(DIESEL, FUEL=="F3"&BRAND=="B2")
Table_F3_B2
ybar32=mean(Table_F3_B2$PERFORM)
ybar32
```

#Graph of sample means for engine performance

```{r}

library(ggplot2)

ggplot(DIESEL,aes(x=factor(FUEL),y=PERFORM,colour=BRAND,group=BRAND))+
   geom_point()+
   stat_summary(aes(y=PERFORM,group=BRAND),fun= mean,geom = "line")+
   ggtitle("RStudio graph of sample means for engine performance")

interaction.plot(DIESEL$FUEL,DIESEL$BRAND, DIESEL$PERFORM, legend = TRUE, col = 2:3, xlab="Fuel Type", ylab="PERFORM",trace.label = "Brand Type")
```
d) Do the data provide sufficient evidence to indicate that $F$ and $B$ interact?

$H_0: \beta_4 =\beta_5 = 0$

$H_a$ at least one of $\beta_4$ and $\beta_5$ doffers from zero

Reduced model: Main Effects Model

Complete model: Model with main Effects and interaction terms

```{r}
##Partial F Test

modelDUMMY1=lm(PERFORM~x1+x2+x3)

modelDUMMY2=lm(PERFORM~x1+x2+x3+x1*x3+x2*x3)
anova(modelDUMMY1, modelDUMMY2)

```

